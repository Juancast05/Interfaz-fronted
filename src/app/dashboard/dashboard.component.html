<div class="dashboard-container">
  <mat-card class="dashboard-card">
    <mat-card-header>
      <mat-card-title class="dashboard-title"
        >Sistema de Gestión de Cámaras</mat-card-title
      >
      <mat-card-subtitle class="quipux-watermark">Quipux</mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div class="filter-section">
        <h3>Filtrar Cámaras</h3>
        <form [formGroup]="filterForm" class="filter-form">
          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filtrar por Cliente</mat-label>
            <mat-select formControlName="id_cliente_sistema">
              <mat-option [value]="null">Todos los Clientes</mat-option>
              <mat-option
                *ngFor="let cliente of clientes"
                [value]="cliente.id_cliente_sistema"
              >
                {{ cliente.nombre }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <mat-form-field appearance="outline" class="filter-field">
            <mat-label>Filtrar por Estado</mat-label>
            <mat-select formControlName="activo">
              <mat-option [value]="null">Todos los Estados</mat-option>
              <mat-option value="si">Activo</mat-option>
              <mat-option value="no">Inactivo</mat-option>
            </mat-select>
          </mat-form-field>
        </form>
      </div>

      <div class="dashboard-data">
        <h3>Cámaras ({{ filteredCamaras.length }})</h3>
        <button
          mat-raised-button
          color="primary"
          routerLink="/camaras/new"
          class="add-button"
        >
          <mat-icon>add</mat-icon>
          Añadir Cámara
        </button>

        <div class="table-responsive">
          <table
            mat-table
            [dataSource]="filteredCamaras"
            class="mat-elevation-z4 dashboard-table"
          >
            <ng-container matColumnDef="alias_camara">
              <th mat-header-cell *matHeaderCellDef>Alias Cámara</th>
              <td mat-cell *matCellDef="let camara">
                {{ camara.alias_camara }}
              </td>
            </ng-container>

            <ng-container matColumnDef="codigo_camara">
              <th mat-header-cell *matHeaderCellDef>Código Cámara</th>
              <td mat-cell *matCellDef="let camara">
                {{ camara.codigo_camara }}
              </td>
            </ng-container>

            <ng-container matColumnDef="direccion">
              <th mat-header-cell *matHeaderCellDef>Dirección</th>
              <td mat-cell *matCellDef="let camara">{{ camara.direccion }}</td>
            </ng-container>

            <ng-container matColumnDef="activo">
              <th mat-header-cell *matHeaderCellDef>Estado</th>
              <td mat-cell *matCellDef="let camara">
                <span [class]="getEstadoClass(camara.activo)">
                  {{
                    camara.activo?.toLowerCase() === "si"
                      ? "Activo"
                      : camara.activo?.toLowerCase() === "no"
                      ? "Inactivo"
                      : "N/A"
                  }}
                </span>
              </td>
            </ng-container>

            <ng-container matColumnDef="cliente">
              <th mat-header-cell *matHeaderCellDef>Cliente</th>
              <td mat-cell *matCellDef="let camara">
                {{ getClienteNombre(camara.id_cliente_sistema) }}
              </td>
            </ng-container>

            <ng-container matColumnDef="acciones">
              <th mat-header-cell *matHeaderCellDef>Acciones</th>
              <td mat-cell *matCellDef="let camara">
                <button
                  mat-icon-button
                  color="accent"
                  (click)="editCamara(camara.id_camara)"
                >
                  <mat-icon>edit</mat-icon>
                </button>
                <button
                  mat-icon-button
                  color="warn"
                  (click)="deleteCamara(camara.id_camara)"
                >
                  <mat-icon>delete</mat-icon>
                </button>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>

            <tr class="mat-row" *matNoDataRow>
              <td class="mat-cell" colspan="6">
                No se encontraron cámaras con los filtros aplicados.
              </td>
            </tr>
          </table>
        </div>
      </div>

      <div class="dashboard-navigation">
        <button
          mat-raised-button
          color="primary"
          routerLink="/clientes"
          class="nav-button"
        >
          Gestión de Clientes
        </button>
        <button
          mat-raised-button
          color="primary"
          routerLink="/camaras"
          class="nav-button"
        >
          Ver todas las Cámaras
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
